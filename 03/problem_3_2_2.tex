\begin{alltt}
\textcolor{linenr}{001  }
\textcolor{linenr}{002  }\textcolor{comment}{% problem 3\_2\_2}
\textcolor{linenr}{003  }
\textcolor{linenr}{004  }clear all;
\textcolor{linenr}{005  }close all;
\textcolor{linenr}{006  }
\textcolor{linenr}{007  }[ x\_test, y\_test, x\_train, y\_train, TestSet, x\_min, x\_max, x\_step] = load\_input();
\textcolor{linenr}{008  }
\textcolor{linenr}{009  }MIN\_GRADIENT\_DESCENT = 0.0001;
\textcolor{linenr}{010  }performance\_function = \textcolor{string}{'mse'};
\textcolor{linenr}{011  }neuron\_count = 8;
\textcolor{linenr}{012  }epoch\_count = 700;
\textcolor{linenr}{013  }\textcolor{keyword}{if} exist(\textcolor{string}{'SPEED'}, \textcolor{string}{'file'})
\textcolor{linenr}{014  }    epoch\_count = 50;
\textcolor{linenr}{015  }\textcolor{keyword}{end}
\textcolor{linenr}{016  }
\textcolor{linenr}{017  }[ network, performance ] = create\_and\_train\_network( x\_min, x\_max, \textcolor{keyword}{\underline{...}}
\textcolor{linenr}{018  }    neuron\_count, performance\_function, epoch\_count, \textcolor{keyword}{\underline{...}}
\textcolor{linenr}{019  }    x\_train, y\_train, x\_test, y\_test);
\textcolor{linenr}{020  }
\textcolor{linenr}{021  }\textcolor{comment}{% check trained network with new input}
\textcolor{linenr}{022  }x = x\_min:x\_step:x\_max;
\textcolor{linenr}{023  }y\_learned = sim(network, x);
\textcolor{linenr}{024  }
\textcolor{linenr}{025  }plot\_filename\_prefix = sprintf(\textcolor{string}{'3\_2\_2\_\%d\_epochs'}, epoch\_count);
\textcolor{linenr}{026  }figure\_title = \textcolor{string}{'training and test data - Early Stopping'};
\textcolor{linenr}{027  }plot\_curves(x, y\_learned, x\_train, y\_train, \textcolor{keyword}{\underline{...}}
\textcolor{linenr}{028  }    figure\_title, plot\_filename\_prefix)
\textcolor{linenr}{029  }
\textcolor{linenr}{030  }figure\_title = \textcolor{string}{'MSE for the number of epochs used - Early Stopping'};
\textcolor{linenr}{031  }error\_x\_label = \textcolor{string}{'\# epochs'};
\textcolor{linenr}{032  }plot\_error(performance.tperf, performance.perf, \textcolor{keyword}{\underline{...}}
\textcolor{linenr}{033  }    figure\_title, error\_x\_label, plot\_filename\_prefix); 
\textcolor{linenr}{034  }
\textcolor{linenr}{035  }\textcolor{comment}{%min MSE}
\textcolor{linenr}{036  }mse\_gradient = gradient(performance.perf);
\textcolor{linenr}{037  }\textcolor{keyword}{for} i = 1:length(mse\_gradient)
\textcolor{linenr}{038  }    \textcolor{keyword}{if} mse\_gradient(i) < MIN\_GRADIENT\_DESCENT \&\& mse\_gradient(i) > -MIN\_GRADIENT\_DESCENT
\textcolor{linenr}{039  }        epoch\_count = i; \textcolor{comment}{% min gradient reached}
\textcolor{linenr}{040  }        \textcolor{keyword}{break};
\textcolor{linenr}{041  }    \textcolor{keyword}{end}
\textcolor{linenr}{042  }\textcolor{keyword}{end}
\textcolor{linenr}{043  }
\textcolor{linenr}{044  }\textcolor{comment}{%[min\_mse, epoch\_index\_with\_min\_error] = min(performance.perf);}
\textcolor{linenr}{045  }
\textcolor{linenr}{046  }\textcolor{comment}{%configure}
\textcolor{linenr}{047  }network2 = network;
\textcolor{linenr}{048  }network2.trainParam.epochs = epoch\_count;
\textcolor{linenr}{049  }[network2, performance2] = train(network2, x\_train, y\_train, [],[],[], TestSet);
\textcolor{linenr}{050  }
\textcolor{linenr}{051  }\textcolor{comment}{% check trained network with new input}
\textcolor{linenr}{052  }x = x\_min:x\_step:x\_max;
\textcolor{linenr}{053  }y\_learned = sim(network2, x);
\textcolor{linenr}{054  }
\textcolor{linenr}{055  }plot\_filename\_prefix = sprintf(\textcolor{string}{'3\_2\_2\_\%d\_epochs'}, epoch\_count);
\textcolor{linenr}{056  }figure\_title = \textcolor{string}{'training and test data - Early Stopping'};
\textcolor{linenr}{057  }plot\_curves(x, y\_learned, x\_train, y\_train, \textcolor{keyword}{\underline{...}}
\textcolor{linenr}{058  }    figure\_title, plot\_filename\_prefix)
\textcolor{linenr}{059  }
\textcolor{linenr}{060  }figure\_title = \textcolor{string}{'MSE for the number of epochs used'};
\textcolor{linenr}{061  }error\_x\_label = \textcolor{string}{'\# epochs'};
\textcolor{linenr}{062  }plot\_error(performance2.tperf, performance2.perf, \textcolor{keyword}{\underline{...}}
\textcolor{linenr}{063  }    figure\_title, error\_x\_label, plot\_filename\_prefix); 
\end{alltt}
